{
  "name": "PoD",
  "nodes": [
    {
      "parameters": {},
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        -4928,
        -1952
      ],
      "id": "5671976c-b8fe-4d22-894f-900a7f5c77db",
      "name": "When clicking ‚ÄòExecute workflow‚Äô"
    },
    {
      "parameters": {
        "resource": "product",
        "operation": "create",
        "name": "={{ $json.ten_san_pham }}",
        "additionalFields": {
          "description": "={{ $json.main_description_html }}\n\n<br><hr><br>\n<div style=\"text-align: center;\">\n  <p><strong>Official Authentic Product</strong></p>\n  <a href=\"https://hoopswaghouse.com/\" target=\"_blank\" rel=\"nofollow\">\n     <img src=\"https://hoopswaghouse.com/wp-content/uploads/2025/12/HoopSwagHouse_logo.png\" width=\"200\" alt=\"HoopSwagHouse\">\n  </a>\n</div>",
          "regularPrice": "={{ $json.gia_goc }}",
          "salePrice": "={{ $json.gia_sale }}",
          "shortDescription": "={{ $json.short_description }}",
          "slug": "={{ $json.slug }}"
        },
        "dimensionsUi": {},
        "imagesUi": {
          "imagesValues": [
            {
              "alt": "={{ $json.woo_images[0].alt }}",
              "src": "={{ $json.woo_images[0].src }}",
              "name": ""
            },
            {
              "alt": "={{ $json.woo_images[1].alt }}",
              "src": "={{ $json.woo_images[1].src }}",
              "name": ""
            },
            {
              "alt": "={{ $json.woo_images[2].alt }}",
              "src": "={{ $json.woo_images[2].src }}",
              "name": ""
            }
          ]
        },
        "metadataUi": {
          "metadataValues": [
            {
              "key": "rank_math_focus_keyword",
              "value": "={{ $json.tu_khoa_seo }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.wooCommerce",
      "typeVersion": 1,
      "position": [
        -3488,
        -2592
      ],
      "id": "24ca0b90-3cff-468d-b261-8725d6cefef6",
      "name": "Hoop",
      "credentials": {
        "wooCommerceApi": {
          "id": "Ip4IJydFOznVQufe",
          "name": "Hoop Credetials"
        }
      }
    },
    {
      "parameters": {
        "url": "https://hoopswaghouse.com//wp-json/wc/v3/products/categories",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "wooCommerceApi",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "per_page",
              "value": "100"
            }
          ]
        },
        "options": {
          "batching": {
            "batch": {}
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -2992,
        -2064
      ],
      "id": "4dbd5466-c531-4fce-af6f-55761b453b4f",
      "name": "L·ªçc Categories cho Hoop",
      "credentials": {
        "wooCommerceApi": {
          "id": "Ip4IJydFOznVQufe",
          "name": "Hoop Credetials"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// --- C·∫§U H√åNH ---\n// Ki·ªÉm tra xem d·ªØ li·ªáu ƒë·∫ßu v√†o c√≥ ƒë√∫ng l√† m·∫£ng kh√¥ng, n·∫øu kh√¥ng th√¨ ƒë∆∞a v√†o m·∫£ng\nconst inputItems = Array.isArray(items) ? items : [items];\n\n// 1. L·ªçc v√† l·∫•y c√°c tr∆∞·ªùng c·∫ßn thi·∫øt (ID v√† Name)\nconst categories = inputItems.map(item => {\n  // ƒê√¥i khi d·ªØ li·ªáu n·∫±m s√¢u trong json.body ho·∫∑c json, t√πy API\n  const data = item.json; \n  return {\n    id: data.id,\n    name: data.name\n    // count: data.count // B·ªè comment n·∫øu mu·ªën l·∫•y th√™m s·ªë l∆∞·ª£ng s·∫£n ph·∫©m\n  };\n}).filter(c => c.id && c.name); // Lo·∫°i b·ªè c√°c d√≤ng l·ªói kh√¥ng c√≥ ID ho·∫∑c Name\n\n// 2. T·∫°o chu·ªói vƒÉn b·∫£n danh s√°ch ƒë·ªÉ ƒë∆∞a v√†o Prompt AI\n// K·∫øt qu·∫£ s·∫Ω gi·ªëng: \"[12] √Åo Thun | [15] Qu·∫ßn Jeans | ...\"\nconst categoriesContext = categories\n  .map(c => `[${c.id}] ${c.name}`)\n  .join(\" | \"); \n\n// 3. Tr·∫£ v·ªÅ k·∫øt qu·∫£ duy nh·∫•t (1 item) ch·ª©a danh s√°ch n√†y\nreturn [\n  {\n    json: {\n      total_cats: categories.length,\n      cat_list_text: categoriesContext, // D√πng bi·∫øn n√†y cho AI\n      cat_raw_data: categories // Gi·ªØ l·∫°i data g·ªëc ƒë·ªÉ debug n·∫øu c·∫ßn\n    }\n  }\n];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2992,
        -1840
      ],
      "id": "91ce0426-a13f-4af0-8a77-3fe7976ad062",
      "name": "Gom Categories"
    },
    {
      "parameters": {
        "url": "https://hoopswaghouse.com/wp-json/wc/v3/products/tags",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "wooCommerceApi",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "per_page",
              "value": "100"
            }
          ]
        },
        "options": {
          "pagination": {
            "pagination": {
              "parameters": {
                "parameters": [
                  {
                    "name": "page",
                    "value": "={{ $pageCount + 1 }}"
                  }
                ]
              }
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -2768,
        -2064
      ],
      "id": "561b1d81-f41f-453d-8a8b-97c06b8809bb",
      "name": "L·ªçc Tags cho Hoop",
      "credentials": {
        "wooCommerceApi": {
          "id": "Ip4IJydFOznVQufe",
          "name": "Hoop Credetials"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// --- C·∫§U H√åNH ---\nconst inputItems = Array.isArray(items) ? items : [items];\n\n// 1. X·ª≠ l√Ω Tags (T∆∞∆°ng t·ª± Categories)\nconst tags = inputItems.map(item => {\n  const data = item.json;\n  return {\n    id: data.id,\n    name: data.name\n  };\n}).filter(t => t.id && t.name);\n\n// 2. T·∫°o chu·ªói vƒÉn b·∫£n Tags\n// Tags th∆∞·ªùng nhi·ªÅu, n√™n d√πng d·∫•u xu·ªëng d√≤ng \\n ƒë·ªÉ r√µ r√†ng h∆°n\nconst tagsContext = tags\n  .map(t => `[${t.id}] ${t.name}`)\n  .join(\", \"); \n\n// 3. L·∫•y l·∫°i d·ªØ li·ªáu Categories t·ª´ node tr∆∞·ªõc ƒë√≥ (Gom Categories)\n// Gi·∫£ s·ª≠ node tr∆∞·ªõc t√™n l√† \"Gom Categories\"\n// L∆∞u √Ω: N·∫øu n8n b√°o l·ªói kh√¥ng t√¨m th·∫•y, h√£y ƒë·∫£m b·∫£o node n√†y n·ªëi d√¢y t·ª´ nh√°nh ch·ª©a Gom Categories\nlet catContext = \"\";\ntry {\n    // Th·ª≠ l·∫•y t·ª´ context c·ªßa node cha n·∫øu d√≤ng ch·∫£y li·ªÅn m·∫°ch\n    // Ho·∫∑c b·∫°n c√≥ th·ªÉ d√πng $(\"Gom Categories\").first().json.cat_list_text n·∫øu kh√¥ng n·ªëi d√¢y tr·ª±c ti·∫øp\n    // ·ªû ƒë√¢y t√¥i gi·∫£ ƒë·ªãnh b·∫°n d√πng bi·∫øn to√†n c·ª•c ho·∫∑c tham chi·∫øu node:\n    const previousNodeData = $(\"Gom Categories\").first(); \n    catContext = previousNodeData ? previousNodeData.json.cat_list_text : \"Kh√¥ng t√¨m th·∫•y data Categories\";\n} catch (error) {\n    catContext = \"L·ªói l·∫•y data Categories (Ki·ªÉm tra l·∫°i t√™n node)\";\n}\n\n// 4. Tr·∫£ v·ªÅ 1 c·ª•c d·ªØ li·ªáu ch·ª©a T·∫§T C·∫¢ (Context t·ªïng)\nreturn [\n  {\n    json: {\n      // D·ªØ li·ªáu Tags m·ªõi x·ª≠ l√Ω\n      total_tags: tags.length,\n      tag_list_text: tagsContext,\n      \n      // D·ªØ li·ªáu Categories ƒë∆∞·ª£c b·∫£o l∆∞u\n      cat_list_text: catContext,\n\n      // T·∫°o m·ªôt l·ªùi nh·∫Øc m·∫´u cho AI lu√¥n ƒë·ªÉ ti·ªán d√πng\n      ai_system_prompt_part: `Danh s√°ch Categories (Format: [ID] T√™n): ${catContext}\\n\\nDanh s√°ch Tags (Format: [ID] T√™n): ${tagsContext}`\n    }\n  }\n];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2768,
        -1840
      ],
      "id": "0a23f138-a8e7-4c1e-a9e1-22824509efc8",
      "name": "Gom Tags"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://leaguelockergear.com/wp-json/wp/v2/media",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "wordpressApi",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Disposition",
              "value": "=attachment; filename={{ $binary.data.fileName }}"
            },
            {
              "name": "Content-Type",
              "value": "={{ $binary.data.mimeType }}"
            }
          ]
        },
        "sendBody": true,
        "contentType": "binaryData",
        "inputDataFieldName": "data",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -4032,
        -1648
      ],
      "id": "a2f6377e-57c6-492c-bda3-e08339c5d916",
      "name": "HTTP Request",
      "credentials": {
        "wordpressApi": {
          "id": "ZGGfckD1rZUtyuNQ",
          "name": "Wordpress account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// L·∫•y t·∫•t c·∫£ c√°c items ƒë·∫ßu ra t·ª´ node WordPress (ch·∫°y 3 l·∫ßn)\n// Thay \"WordPress\" b·∫±ng t√™n ch√≠nh x√°c c·ªßa node upload c·ªßa b·∫°n\nconst allItems = $items(\"HTTP Request\"); \n\n// Tr√≠ch xu·∫•t link ·∫£nh t·ª´ k·∫øt qu·∫£\nconst urls = allItems.map(item => item.json.source_url);\n\n// Tr·∫£ v·ªÅ 1 item duy nh·∫•t ch·ª©a c·∫£ 3 link ƒë√£ ƒë∆∞·ª£c ph√¢n lo·∫°i\nreturn [{\n    json: {\n        anh_3: urls[0] || \"\", // Link ·∫£nh ƒë·∫ßu ti√™n\n        anh_2: urls[1] || \"\", // Link ·∫£nh th·ª© hai\n        anh_1: urls[2] || \"\"  // Link ·∫£nh th·ª© ba\n    }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3856,
        -1648
      ],
      "id": "958d16b4-2e98-4b07-80a9-1cb9d4a7ad33",
      "name": "Code in JavaScript8"
    },
    {
      "parameters": {
        "resource": "fileFolder",
        "searchMethod": "query",
        "queryString": "='1FsV7AhUQJGqcawPq4w2fROVN_UVNTkdX' in parents and mimeType = 'application/vnd.google-apps.folder' and trashed = false",
        "filter": {},
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        -5264,
        -1568
      ],
      "id": "b6b2b83c-5802-454e-ab95-47642477a7d0",
      "name": "Search (LEAGUE)",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "rUlF8VcqJqVjB4ff",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "resource": "fileFolder",
        "searchMethod": "query",
        "queryString": "='1UTQWli6MEY-pYNZVFjKENSPVVDsWLlqP' in parents and mimeType = 'application/vnd.google-apps.folder' and trashed = false",
        "filter": {},
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        -5232,
        -2272
      ],
      "id": "995f89bf-0391-4068-ac4c-886ee01f8854",
      "name": "Search (HOOP)",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "rUlF8VcqJqVjB4ff",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://hoopswaghouse.com/wp-json/wp/v2/media",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "wordpressApi",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Disposition",
              "value": "=attachment; filename={{ $binary.data.fileName }}"
            },
            {
              "name": "Content-Type",
              "value": "={{ $binary.data.mimeType }}"
            }
          ]
        },
        "sendBody": true,
        "contentType": "binaryData",
        "inputDataFieldName": "data",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -4016,
        -2336
      ],
      "id": "0ceb9335-34e2-41eb-ac00-98c21e6d00f7",
      "name": "HTTP POST HOOP",
      "credentials": {
        "wordpressApi": {
          "id": "wK2UB39hFBJwS9VA",
          "name": "Wordpress account 2"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// L·∫•y t·∫•t c·∫£ c√°c items ƒë·∫ßu ra t·ª´ node WordPress (ch·∫°y 3 l·∫ßn)\n// Thay \"WordPress\" b·∫±ng t√™n ch√≠nh x√°c c·ªßa node upload c·ªßa b·∫°n\nconst allItems = $items(\"HTTP POST HOOP\"); \n\n// Tr√≠ch xu·∫•t link ·∫£nh t·ª´ k·∫øt qu·∫£\nconst urls = allItems.map(item => item.json.source_url);\n\n// Tr·∫£ v·ªÅ 1 item duy nh·∫•t ch·ª©a c·∫£ 3 link ƒë√£ ƒë∆∞·ª£c ph√¢n lo·∫°i\nreturn [{\n    json: {\n        anh_3: urls[0] || \"\", // Link ·∫£nh ƒë·∫ßu ti√™n\n        anh_2: urls[1] || \"\", // Link ·∫£nh th·ª© hai\n        anh_1: urls[2] || \"\"  // Link ·∫£nh th·ª© ba\n    }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3840,
        -2336
      ],
      "id": "7e834f47-ed60-46d6-a0cf-6fd6088d7bc6",
      "name": "Code in JavaScript9"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -4464,
        -2592
      ],
      "id": "c134692b-47d8-4335-a531-a4dfbeca9717",
      "name": "Loop Over Items4"
    },
    {
      "parameters": {
        "jsCode": "// L·∫•y n·ªôi dung text g·ªëc t·ª´ Gemini\nconst rawText = items[0].json.content.parts[0].text;\n\ntry {\n  // 1. T√¨m v·ªã tr√≠ d·∫•u ngo·∫∑c nh·ªçn m·ªü '{' ƒë·∫ßu ti√™n v√† ƒë√≥ng '}' cu·ªëi c√πng\n  const firstOpen = rawText.indexOf('{');\n  const lastClose = rawText.lastIndexOf('}');\n\n  if (firstOpen === -1 || lastClose === -1) {\n    throw new Error(\"Kh√¥ng t√¨m th·∫•y d·∫•u ngo·∫∑c JSON {} trong ph·∫£n h·ªìi c·ªßa AI\");\n  }\n\n  // 2. C·∫Øt l·∫•y ƒë√∫ng ƒëo·∫°n JSON, b·ªè qua l·ªùi d·∫´n chuy·ªán th·ª´a th√£i\n  let cleanJson = rawText.substring(firstOpen, lastClose + 1);\n\n  // 3. (M·∫πo n√¢ng cao) S·ª≠a l·ªói d√≤ng m·ªõi n·∫øu AI l·ª° xu·ªëng d√≤ng trong chu·ªói\n  // cleanJson = cleanJson.replace(/\\n/g, \"\\\\n\"); // Ch·ªâ b·∫≠t d√≤ng n√†y n·∫øu v·∫´n l·ªói\n\n  // 4. Parse JSON\n  const data = JSON.parse(cleanJson);\n\n  return [ { json: data } ];\n\n} catch (error) {\n  // N·∫øu l·ªói, tr·∫£ v·ªÅ nguy√™n vƒÉn text ƒë·ªÉ Debug xem sai ·ªü ƒë√¢u\n  return [\n    {\n      json: {\n        error: error.message,\n        raw_content_to_debug: rawText // Xem c√°i n√†y ·ªü c·ªôt Output ƒë·ªÉ bi·∫øt AI vi·∫øt sai ch·ªó n√†o\n      }\n    }\n  ];\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3984,
        -2528
      ],
      "id": "5d5b32c0-e0c5-49f0-b0fa-4af2944adcf0",
      "name": "Code in JavaScript10"
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineByPosition",
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        -3824,
        -2592
      ],
      "id": "16974bc2-0b0d-46e6-bce3-fa566c567c43",
      "name": "Merge4"
    },
    {
      "parameters": {
        "jsCode": "\nconst item = items[0].json;\n\n// L·∫•y n·ªôi dung b√†i vi·∫øt t·ª´ AI\nlet content = item.main_description_html || \"\"; // Th√™m || \"\" ƒë·ªÉ tr√°nh l·ªói n·∫øu null\n\n// L·∫•y link ·∫£nh t·ª´ Sheet\nconst linkImg1 = item.anh_1; \nconst linkImg2 = item.anh_2;\nconst altText = item.ten_san_pham; \n\n// T·∫°o m√£ HTML cho ·∫£nh\nconst htmlImg1 = `<figure style=\"text-align:center; margin: 25px 0;\">\n                    <img src=\"${linkImg1}\" alt=\"${altText} - Front View\" style=\"max-width: 100%; height: auto; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);\">\n                    <figcaption style=\"font-style: italic; color: #555; margin-top: 5px;\">${altText}</figcaption>\n                 </figure>`;\n\nconst htmlImg2 = `<figure style=\"text-align:center; margin: 25px 0;\">\n                    <img src=\"${linkImg2}\" alt=\"${altText} - Detail View\" style=\"max-width: 100%; height: auto; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);\">\n                 </figure>`;\n\n// TH·ª∞C HI·ªÜN THAY TH·∫æ\n// 1. ·∫¢nh 1\nif (content.includes('[IMG_1]') && linkImg1) {\n    content = content.replace('[IMG_1]', htmlImg1);\n} else if (linkImg1) {\n    content = content.replace('</p>', '</p>' + htmlImg1);\n}\n\n// 2. ·∫¢nh 2\nif (content.includes('[IMG_2]') && linkImg2) {\n    content = content.replace('[IMG_2]', htmlImg2);\n} else if (linkImg2) {\n    content += htmlImg2;\n}\n\n// C·∫≠p nh·∫≠t l·∫°i n·ªôi dung\nitem.main_description_html = content;\n\n// T·∫†O GALLERY CHO WOOCOMMERCE\nconst images = [];\nfunction addImage(url) {\n  if (url && url.toString().startsWith('http')) {\n    images.push({ src: url.toString().trim(), alt: altText });\n  }\n}\naddImage(item.anh_1);\naddImage(item.anh_2);\naddImage(item.anh_3);\naddImage(item.anh_4);\n\n// ================================================================\n// PH·∫¶N 3: TR·∫¢ V·ªÄ K·∫æT QU·∫¢ T·ªîNG H·ª¢P\n// ================================================================\n\nreturn [{\n  json: {\n    ...item,\n    woo_images: images\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3664,
        -2592
      ],
      "id": "9e28d3c6-0bfe-4e1d-90b8-f505a41ed990",
      "name": "Code in JavaScript11"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -5040,
        -2272
      ],
      "id": "c1d25261-6cf4-4048-9ab8-3da8f5c97c22",
      "name": "Loop Over Items5"
    },
    {
      "parameters": {
        "resource": "fileFolder",
        "searchMethod": "query",
        "queryString": "='{{ $json.id }}' in parents and trashed = false",
        "filter": {},
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        -4864,
        -2256
      ],
      "id": "504829dc-df5f-45f7-8713-64c3789af611",
      "name": "Search files and folders",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "rUlF8VcqJqVjB4ff",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "operation": "download",
        "fileId": {
          "__rl": true,
          "value": "={{ $json.id }}",
          "mode": "id"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        -4464,
        -2256
      ],
      "id": "fed97be6-19f5-4a62-b933-06c5aaadef55",
      "name": "Download file1",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "rUlF8VcqJqVjB4ff",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// T·∫°o ti·ªÅn t·ªë ng√†y th√°ng (VD: 20251203)\nconst prefix = new Date().toISOString().slice(0, 10).replace(/-/g, \"\");\n\n// Duy·ªát qua T·∫§T C·∫¢ c√°c items (·∫£nh) trong danh s√°ch\n// D√πng v√≤ng l·∫∑p for...of ƒë·ªÉ x·ª≠ l√Ω t·ª´ng item m·ªôt\nlet index = 1; // Bi·∫øn ƒë·∫øm ƒë·ªÉ ƒë√°nh s·ªë th·ª© t·ª± ·∫£nh n·∫øu c·∫ßn\n\nfor (const item of items) {\n  // Ki·ªÉm tra xem item c√≥ d·ªØ li·ªáu binary (·∫£nh) kh√¥ng cho ch·∫Øc ƒÉn\n  if (item.binary && item.binary.data) {\n    \n    const oldName = item.binary.data.fileName;\n    \n    // ƒê·ªïi t√™n: Ng√†yTh√°ng_T√™nC≈©\n    // V√≠ d·ª•: 20251203_anh-san-pham.jpg\n    item.binary.data.fileName = `${prefix}_${oldName}`;\n    \n    // M·∫∏O: N·∫øu mu·ªën ch·∫Øc ch·∫Øn kh√¥ng tr√πng, b·∫°n c√≥ th·ªÉ th√™m s·ªë th·ª© t·ª± v√†o:\n    // item.binary.data.fileName = `${prefix}_${index}_${oldName}`;\n    \n    index++;\n  }\n}\n\nreturn items;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -4192,
        -2336
      ],
      "id": "45d96524-b83a-4f75-88e6-4c62d953d4d7",
      "name": "Code in JavaScript12"
    },
    {
      "parameters": {
        "keep": "lastItems"
      },
      "type": "n8n-nodes-base.limit",
      "typeVersion": 1,
      "position": [
        -4192,
        -2192
      ],
      "id": "eb634b17-c6dc-4e5b-8883-9bc58d9cad86",
      "name": "Limit1"
    },
    {
      "parameters": {
        "jsCode": "// L·∫•y d·ªØ li·ªáu item ƒë·∫ßu ti√™n\nconst item = items[0].json;\n\n// 1. TR√çCH XU·∫§T D·ªÆ LI·ªÜU CH√çNH X√ÅC (D·ª±a tr√™n Debug c·ªßa b·∫°n)\n// C·∫•u tr√∫c l√†: content -> parts[0] -> text\nlet rawText = \"\";\n\nif (item.content && item.content.parts && item.content.parts.length > 0) {\n    rawText = item.content.parts[0].text;\n} else {\n    // D·ª± ph√≤ng n·∫øu c·∫•u tr√∫c thay ƒë·ªïi\n    rawText = item.text || item.output || \"\";\n}\n\n// 2. L√ÄM S·∫†CH CHU·ªñI (X√≥a k√Ω t·ª± markdown ```json)\n// V√¨ rawText ƒëang l√† chu·ªói: \"```json\\n{...}\\n```\"\nconst cleanJson = rawText.replace(/```json|```/g, '').trim();\n\ntry {\n    // 3. CHUY·ªÇN TH√ÄNH OBJECT\n    const productInfo = JSON.parse(cleanJson);\n    \n    // 4. X·ª¨ L√ù LOGIC SLUG (Theo y√™u c·∫ßu < 92 k√Ω t·ª±)\n    let title = productInfo.ten_san_pham || \"Untitled Product\";\n    let slug = productInfo.slug || \"\";\n    \n    // N·∫øu AI qu√™n slug, t·ª± t·∫°o t·ª´ t·ª´ kh√≥a\n    if (!slug) {\n        const source = productInfo.tu_khoa_seo || title;\n        slug = source.toLowerCase().replace(/[^a-z0-9]+/g, '-');\n    }\n    \n    // C·∫Øt slug c·ª©ng n·∫øu d√†i h∆°n 91 k√Ω t·ª±\n    if (slug.length > 91) {\n        slug = slug.substring(0, 91);\n        slug = slug.replace(/-+$/, ''); // X√≥a d·∫•u g·∫°ch th·ª´a ·ªü ƒëu√¥i\n    }\n    \n    return [{\n        json: {\n            ten_san_pham: title,\n            tu_khoa_seo: productInfo.tu_khoa_seo || \"pod product\",\n            slug: slug\n        }\n    }];\n\n} catch (error) {\n    // N·∫øu v·∫´n l·ªói, in ra nguy√™n nh√¢n ƒë·ªÉ s·ª≠a\n    return [{\n        json: {\n            error: \"L·ªói Parse JSON\",\n            message: error.message,\n            raw_input_received: rawText\n        }\n    }];\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3840,
        -2192
      ],
      "id": "bf08b064-a71a-402e-916e-7df717f5f530",
      "name": "Code in JavaScript13"
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineByPosition",
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        -3664,
        -2272
      ],
      "id": "9522b8fb-a197-477d-a398-8516d1e6cce7",
      "name": "Merge5"
    },
    {
      "parameters": {
        "resource": "product",
        "operation": "create",
        "name": "={{ $json.ten_san_pham }}",
        "additionalFields": {
          "description": "={{ $json.main_description_html }}\n\n<br><hr><br>\n<div style=\"text-align: center;\">\n  <p><strong>Official Authentic Product</strong></p>\n  <a href=\"https://leaguelockergear.com/\" target=\"_blank\" rel=\"nofollow\">\n     <img src=\"https://leaguelockergear.com/wp-content/uploads/2025/10/cropped-logo-remove-small.png\" width=\"200\" alt=\"League Locker Gear\">\n  </a>\n</div>",
          "shortDescription": "={{ $json.short_description }}",
          "slug": "={{ $json.slug }}"
        },
        "dimensionsUi": {},
        "imagesUi": {
          "imagesValues": [
            {
              "alt": "={{ $json.woo_images[0].alt }}",
              "src": "={{ $json.woo_images[0].src }}",
              "name": ""
            },
            {
              "alt": "={{ $json.woo_images[1].alt }}",
              "src": "={{ $json.woo_images[1].src }}",
              "name": ""
            },
            {
              "alt": "={{ $json.woo_images[2].alt }}",
              "src": "={{ $json.woo_images[2].src }}",
              "name": ""
            }
          ]
        },
        "metadataUi": {
          "metadataValues": [
            {
              "key": "rank_math_focus_keyword",
              "value": "={{ $json.tu_khoa_seo }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.wooCommerce",
      "typeVersion": 1,
      "position": [
        -3472,
        -2816
      ],
      "id": "577090cf-c4e5-42f7-9f3e-c7674cdbcac3",
      "name": "Create product (HOOP)",
      "credentials": {
        "wooCommerceApi": {
          "id": "Ip4IJydFOznVQufe",
          "name": "Hoop Credetials"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1DedkgcgjD0YZuy7zRKxFShRsUrsGhhUk7GlDccVjVck",
          "mode": "list",
          "cachedResultName": "Pod",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1DedkgcgjD0YZuy7zRKxFShRsUrsGhhUk7GlDccVjVck/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Hoop",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1DedkgcgjD0YZuy7zRKxFShRsUrsGhhUk7GlDccVjVck/edit#gid=0"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "trang_thai",
              "lookupValue": "Pending"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -4672,
        -2592
      ],
      "id": "b8389c1f-449f-4e44-b904-43ee0bab0930",
      "name": "Sheet Hoop(Input)",
      "executeOnce": false,
      "alwaysOutputData": false,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "6yUNJbZX45z2GUMs",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "1DedkgcgjD0YZuy7zRKxFShRsUrsGhhUk7GlDccVjVck",
          "mode": "list",
          "cachedResultName": "Pod",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1DedkgcgjD0YZuy7zRKxFShRsUrsGhhUk7GlDccVjVck/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Hoop",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1DedkgcgjD0YZuy7zRKxFShRsUrsGhhUk7GlDccVjVck/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "trang_thai": "Pending",
            "ten_san_pham": "={{ $json.ten_san_pham }}",
            "anh_1": "={{ $json.anh_1 }}",
            "anh_2": "={{ $json.anh_2 }}",
            "anh_3": "={{ $json.anh_3 }}",
            "tu_khoa_seo": "={{ $json.tu_khoa_seo }}",
            "slug": "={{ $json.slug }}"
          },
          "matchingColumns": [
            "slug"
          ],
          "schema": [
            {
              "id": "trang_thai",
              "displayName": "trang_thai",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "ten_san_pham",
              "displayName": "ten_san_pham",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "anh_1",
              "displayName": "anh_1",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "anh_2",
              "displayName": "anh_2",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "anh_3",
              "displayName": "anh_3",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "gia_goc",
              "displayName": "gia_goc",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "gia_sale",
              "displayName": "gia_sale",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "tu_khoa_seo",
              "displayName": "tu_khoa_seo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "slug",
              "displayName": "slug",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "tags",
              "displayName": "tags",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "categories",
              "displayName": "categories",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -3472,
        -2224
      ],
      "id": "673e15cf-9ff1-4afe-8a00-125c5648cbad",
      "name": "Sheet Hoop(Raw output, need improve)",
      "executeOnce": false,
      "alwaysOutputData": false,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "6yUNJbZX45z2GUMs",
          "name": "Sheet"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.limit",
      "typeVersion": 1,
      "position": [
        -4880,
        -2448
      ],
      "id": "159b45fc-122f-41e9-a79e-0dd6409e03a0",
      "name": "Limit2"
    },
    {
      "parameters": {
        "jsCode": "// S·∫Øp x·∫øp c√°c item theo t√™n file gi·∫£m d·∫ßn (3 -> 2 -> 1)\nitems.sort((a, b) => {\n  // L·∫•y t√™n file t·ª´ bi·∫øn a v√† b.\n  // H√£y ki·ªÉm tra xem tr∆∞·ªùng t√™n file c·ªßa b·∫°n l√† 'name' hay 'File Name'\n  // Th√¥ng th∆∞·ªùng output t·ª´ Google Drive List l√† 'name'\n  const nameA = a.json.name || a.json['File Name'] || '';\n  const nameB = b.json.name || b.json['File Name'] || '';\n\n  // S·ª≠ d·ª•ng localeCompare v·ªõi t√πy ch·ªçn numeric: true ƒë·ªÉ so s√°nh s·ªë t·ª± nhi√™n\n  // (v√≠ d·ª•: ƒë·ªÉ m√°y hi·ªÉu s·ªë 10 l·ªõn h∆°n s·ªë 2, thay v√¨ so s√°nh chu·ªói thu·∫ßn t√∫y)\n  // b.localeCompare(a) s·∫Ω tr·∫£ v·ªÅ th·ª© t·ª± GI·∫¢M D·∫¶N (Descending)\n  return nameB.localeCompare(nameA, undefined, { numeric: true, sensitivity: 'base' });\n});\n\nreturn items;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -4656,
        -2256
      ],
      "id": "3f625aee-eba6-4641-9cd2-2de81b1a304b",
      "name": "Code in JavaScript3"
    },
    {
      "parameters": {
        "resource": "image",
        "operation": "analyze",
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-flash",
          "mode": "list",
          "cachedResultName": "models/gemini-2.5-flash"
        },
        "text": "You are an expert in SEO and E-commerce (POD).\nAnalyze this product image and extract information in STRICT JSON format.\n\nRULES:\n1. All content must be in ENGLISH.\n2. First, identify the \"tu_khoa_seo\" (Main Keyword). It must be the core product name (3-6 words).\n3. \"ten_san_pham\" MUST follow this exact formula: \"{tu_khoa_seo} - {Descriptive Suffix}\".\n   - The Suffix describes features, material, or theme.\n4. \"slug\" MUST be the kebab-case version of the \"tu_khoa_seo\" (and optionally 1 short category word).\n5. \"slug\" MUST be LESS THAN 86 characters.\n6. Do NOT abbreviate sports team names. Always use the Full Official Name (City + Mascot). Example: Use \"Chicago Bulls\", never just \"Bulls\" or \"Chicago\".\n\nJSON Structure:\n{\n  \"ten_san_pham\": \"Main Keyword - Detailed Suffix\",\n  \"tu_khoa_seo\": \"Main Keyword\",\n  \"slug\": \"main-keyword-category\"\n}\n\nEXAMPLE INPUT (Logic to follow):\n- Image: A whiskey decanter shaped like a basketball player for Lakers fans.\n- OUTPUT JSON:\n{\n  \"ten_san_pham\": \"Los Angeles Lakers Whiskey Bottle - NBA 3D Dunking Player Tribute Decanter\",\n  \"tu_khoa_seo\": \"Los Angeles Lakers Whiskey Bottle\",\n  \"slug\": \"los-angeles-lakers-whiskey-bottle-nba\"\n}",
        "inputType": "binary",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        -4016,
        -2192
      ],
      "id": "8072a15c-dc38-49ab-b53a-292d8ac18742",
      "name": "Ph√¢n t√≠ch ·∫£nh",
      "credentials": {
        "googlePalmApi": {
          "id": "ZbPcQI2SHz0NvP4Y",
          "name": "Gemini"
        }
      }
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-flash",
          "mode": "list",
          "cachedResultName": "models/gemini-2.5-flash"
        },
        "messages": {
          "values": [
            {
              "content": "=B·∫°n l√† m·ªôt chuy√™n gia SEO Copywriter E-commerce (Native English Speaker).\nNhi·ªám v·ª• c·ªßa b·∫°n l√† vi·∫øt n·ªôi dung s·∫£n ph·∫©m chuy√™n s√¢u d·ª±a tr√™n th√¥ng tin sau:\n\nINPUT DATA:\n- Product Name: {{ $json.ten_san_pham }}\n- Focus Keyword: {{ $json.tu_khoa_seo }}\n\nY√äU C·∫¶U NGHI√äM NG·∫∂T V·ªÄ N·ªòI DUNG (STRICT GUIDELINES):\n1. Ng√¥n ng·ªØ: Ti·∫øng Anh chu·∫©n (US English), vƒÉn phong b√°n h√†ng chuy√™n nghi·ªáp, thuy·∫øt ph·ª•c.\n2. ƒê·ªô d√†i: B·∫ÆT BU·ªòC tr√™n 500 t·ª´ (Kh√¥ng t√≠nh ph·∫ßn HTML tags).\n3. ƒê·ªãnh d·∫°ng: HTML chu·∫©n (s·ª≠ d·ª•ng <h2>, <h3>, <p>, <ul>, <li>). Kh√¥ng d√πng th·∫ª <h1>. Kh√¥ng d√πng Markdown (```).\n4. M·∫≠t ƒë·ªô t·ª´ kh√≥a: Duy tr√¨ \"Focus Keyword\" ·ªü m·ª©c 1.2% - 1.5%. Ph·∫£i xu·∫•t hi·ªán t·ª± nhi√™n ·ªü ƒëo·∫°n m·ªü ƒë·∫ßu, √≠t nh·∫•t 1 th·∫ª H2, v√† r·∫£i r√°c trong b√†i.\n5. NO ICONS/EMOJIS: Tuy·ªát ƒë·ªëi kh√¥ng s·ª≠ d·ª•ng icon (üöÄ, üåü,...) trong b√†i vi·∫øt.\n6. N·ªôi dung duy nh·∫•t: T·∫≠p trung s√¢u v√†o m√¥ t·∫£ s·∫£n ph·∫©m (ch·∫•t li·ªáu, c·∫£m gi√°c m·∫∑c, d·ªãp s·ª≠ d·ª•ng, h∆∞·ªõng d·∫´n b·∫£o qu·∫£n). Kh√¥ng vi·∫øt chung chung.\n\nY√äU C·∫¶U V·ªÄ B·ªê C·ª§C H√åNH ·∫¢NH:\nTrong ph·∫ßn n·ªôi dung chi ti·∫øt (main_description_html), b·∫°n h√£y ch√®n 2 k√Ω hi·ªáu gi·ªØ ch·ªó (placeholder) sau:\n1. \"[IMG_1]\" : ƒê·∫∑t ngay sau ƒëo·∫°n m·ªü ƒë·∫ßu (Introduction) ho·∫∑c sau th·∫ª H2 ƒë·∫ßu ti√™n.\n2. \"[IMG_2]\" : ƒê·∫∑t ·ªü g·∫ßn cu·ªëi b√†i vi·∫øt, tr∆∞·ªõc ph·∫ßn k·∫øt lu·∫≠n ho·∫∑c FAQs.\n\nL∆∞u √Ω: Ch·ªâ vi·∫øt ƒë√∫ng k√Ω t·ª± \"[IMG_1]\" v√† \"[IMG_2]\", kh√¥ng t·ª± b·ªãa ra th·∫ª h√¨nh ·∫£nh html.\n\nY√äU C·∫¶U V·ªÄ TR√åNH B√ÄY & KH·∫¢ NƒÇNG ƒê·ªåC (READABILITY):\n1. QUY T·∫ÆC \"3 D√íNG\": Tuy·ªát ƒë·ªëi KH√îNG vi·∫øt ƒëo·∫°n vƒÉn d√†i l√™ th√™ (Wall of text). M·ªói ƒëo·∫°n vƒÉn (paragraph) ch·ªâ ƒë∆∞·ª£c ch·ª©a t·ªëi ƒëa 3 c√¢u ng·∫Øn. Sau 2-3 c√¢u b·∫Øt bu·ªôc ph·∫£i ƒë√≥ng th·∫ª </p> v√† m·ªü th·∫ª <p> m·ªõi.\n2. FORMATTING:\n   - S·ª≠ d·ª•ng danh s√°ch li·ªát k√™ (<ul><li>) b·∫•t c·ª© khi n√†o c√≥ th·ªÉ (thay v√¨ vi·∫øt c√¢u li·ªát k√™ d√†i d√≤ng).\n   - In ƒë·∫≠m (<strong>) c√°c t·ª´ kh√≥a quan tr·ªçng ho·∫∑c l·ª£i √≠ch ch√≠nh ƒë·ªÉ l√†m ƒëi·ªÉm nh·∫•n.\n3. TONE GI·ªåNG: Vi·∫øt g√£y g·ªçn, s√∫c t√≠ch, ng·∫Øt ngh·ªâ r√µ r√†ng ƒë·ªÉ kh√°ch h√†ng l∆∞·ªõt nhanh tr√™n ƒëi·ªán tho·∫°i v·∫´n n·∫Øm ƒë∆∞·ª£c √Ω.\n\nC·∫§U TR√öC B√ÄI VI·∫æT (HTML Output):\n- Ph·∫ßn 1: Introduction (G√¢y ·∫•n t∆∞·ª£ng m·∫°nh, ch·ª©a t·ª´ kh√≥a).\n- Ph·∫ßn 2: Key Features (D√πng <ul>, m√¥ t·∫£ chi ti·∫øt l·ª£i √≠ch).\n- Ph·∫ßn 3: Why You Need This (ƒê√°nh v√†o c·∫£m x√∫c, nhu c·∫ßu qu√† t·∫∑ng/l·ªÖ h·ªôi).\n- Ph·∫ßn 4: Material & Care Instructions (Chi ti·∫øt k·ªπ thu·∫≠t).\n- Ph·∫ßn 5: FAQs (Ph·∫ßn n√†y r·∫•t quan tr·ªçng - xem y√™u c·∫ßu b√™n d∆∞·ªõi).\n\nY√äU C·∫¶U V·ªÄ FAQs (5 C√¢u h·ªèi):\n- Vi·∫øt ƒë√∫ng 5 c√¢u h·ªèi v√† c√¢u tr·∫£ l·ªùi.\n- CH·ª¶ ƒê·ªÄ AN TO√ÄN: Ch·ªâ h·ªèi v·ªÅ size (sizing), v·∫≠n chuy·ªÉn (shipping time), ch·∫•t li·ªáu (material comfort), h∆∞·ªõng d·∫´n gi·∫∑t (washing), qu√† t·∫∑ng (gift wrapping).\n- C·∫§M K·ª¥ (NEGATIVE CONSTRAINT): TUY·ªÜT ƒê·ªêI KH√îNG h·ªèi/tr·∫£ l·ªùi c√°c c√¢u li√™n quan ƒë·∫øn \"Authentic\", \"Official Licensed\", \"Original Brand\". Tr√°nh nh·∫Øc ƒë·∫øn b·∫£n quy·ªÅn th∆∞∆°ng hi·ªáu g·ªëc ƒë·ªÉ ƒë·∫£m b·∫£o an to√†n t√†i kho·∫£n.\n\nOUTPUT FORMAT (JSON RAW ONLY):\nTr·∫£ v·ªÅ duy nh·∫•t 1 object JSON, kh√¥ng k√®m l·ªùi d·∫´n:\n{\n  \"short_description\": \"Vi·∫øt ƒëo·∫°n m√¥ t·∫£ ng·∫Øn (Product Short Description) kho·∫£ng 64 t·ª´. T·∫≠p trung v√†o 'Hook' ƒë·ªÉ kh√°ch h√†ng mu·ªën mua ngay. Kh√¥ng d√πng HTML ·ªü ƒë√¢y, ch·ªâ text th∆∞·ªùng.\",\n  \"main_description_html\": \"To√†n b·ªô n·ªôi dung b√†i vi·∫øt chi ti·∫øt (tr√™n 600 t·ª´) + FAQs theo ƒë·ªãnh d·∫°ng HTML ·ªü tr√™n.\"\n}"
            }
          ]
        },
        "jsonOutput": true,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        -4272,
        -2528
      ],
      "id": "ef4ccb1a-43b6-40de-98c7-1891863d0b00",
      "name": "T·∫°o n·ªôi dung",
      "credentials": {
        "googlePalmApi": {
          "id": "ZbPcQI2SHz0NvP4Y",
          "name": "Gemini"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// T·∫°o ti·ªÅn t·ªë ng√†y th√°ng (VD: 20251203)\nconst prefix = new Date().toISOString().slice(0, 10).replace(/-/g, \"\");\n\n// Duy·ªát qua T·∫§T C·∫¢ c√°c items (·∫£nh) trong danh s√°ch\n// D√πng v√≤ng l·∫∑p for...of ƒë·ªÉ x·ª≠ l√Ω t·ª´ng item m·ªôt\nlet index = 1; // Bi·∫øn ƒë·∫øm ƒë·ªÉ ƒë√°nh s·ªë th·ª© t·ª± ·∫£nh n·∫øu c·∫ßn\n\nfor (const item of items) {\n  // Ki·ªÉm tra xem item c√≥ d·ªØ li·ªáu binary (·∫£nh) kh√¥ng cho ch·∫Øc ƒÉn\n  if (item.binary && item.binary.data) {\n    \n    const oldName = item.binary.data.fileName;\n    \n    // ƒê·ªïi t√™n: Ng√†yTh√°ng_T√™nC≈©\n    // V√≠ d·ª•: 20251203_anh-san-pham.jpg\n    item.binary.data.fileName = `${prefix}_${oldName}`;\n    \n    // M·∫∏O: N·∫øu mu·ªën ch·∫Øc ch·∫Øn kh√¥ng tr√πng, b·∫°n c√≥ th·ªÉ th√™m s·ªë th·ª© t·ª± v√†o:\n    // item.binary.data.fileName = `${prefix}_${index}_${oldName}`;\n    \n    index++;\n  }\n}\n\nreturn items;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -4208,
        -1648
      ],
      "id": "a23218e7-c3c0-4c86-a432-8d16346241c6",
      "name": "ƒê·∫∑t t√™n cho ·∫£nh"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -5056,
        -1568
      ],
      "id": "abf89b2b-1ee5-4ea1-9809-ccb68acf7e98",
      "name": "Loop Over Items7"
    },
    {
      "parameters": {
        "resource": "fileFolder",
        "searchMethod": "query",
        "queryString": "='{{ $json.id }}' in parents and trashed = false",
        "filter": {},
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        -4880,
        -1552
      ],
      "id": "319e8ce9-eb94-47ac-806c-15f4ede711f9",
      "name": "Search files and folders1",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "rUlF8VcqJqVjB4ff",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "operation": "download",
        "fileId": {
          "__rl": true,
          "value": "={{ $json.id }}",
          "mode": "id"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        -4480,
        -1552
      ],
      "id": "ec2c879b-5731-47a3-9899-cf3f092e1dea",
      "name": "Download file2",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "rUlF8VcqJqVjB4ff",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "keep": "lastItems"
      },
      "type": "n8n-nodes-base.limit",
      "typeVersion": 1,
      "position": [
        -4208,
        -1488
      ],
      "id": "f820b422-c62c-4f22-9736-fcc969c0e203",
      "name": "Limit"
    },
    {
      "parameters": {
        "jsCode": "// L·∫•y d·ªØ li·ªáu item ƒë·∫ßu ti√™n\nconst item = items[0].json;\n\n// 1. TR√çCH XU·∫§T D·ªÆ LI·ªÜU CH√çNH X√ÅC (D·ª±a tr√™n Debug c·ªßa b·∫°n)\n// C·∫•u tr√∫c l√†: content -> parts[0] -> text\nlet rawText = \"\";\n\nif (item.content && item.content.parts && item.content.parts.length > 0) {\n    rawText = item.content.parts[0].text;\n} else {\n    // D·ª± ph√≤ng n·∫øu c·∫•u tr√∫c thay ƒë·ªïi\n    rawText = item.text || item.output || \"\";\n}\n\n// 2. L√ÄM S·∫†CH CHU·ªñI (X√≥a k√Ω t·ª± markdown ```json)\n// V√¨ rawText ƒëang l√† chu·ªói: \"```json\\n{...}\\n```\"\nconst cleanJson = rawText.replace(/```json|```/g, '').trim();\n\ntry {\n    // 3. CHUY·ªÇN TH√ÄNH OBJECT\n    const productInfo = JSON.parse(cleanJson);\n    \n    // 4. X·ª¨ L√ù LOGIC SLUG (Theo y√™u c·∫ßu < 92 k√Ω t·ª±)\n    let title = productInfo.ten_san_pham || \"Untitled Product\";\n    let slug = productInfo.slug || \"\";\n    \n    // N·∫øu AI qu√™n slug, t·ª± t·∫°o t·ª´ t·ª´ kh√≥a\n    if (!slug) {\n        const source = productInfo.tu_khoa_seo || title;\n        slug = source.toLowerCase().replace(/[^a-z0-9]+/g, '-');\n    }\n    \n    // C·∫Øt slug c·ª©ng n·∫øu d√†i h∆°n 91 k√Ω t·ª±\n    if (slug.length > 91) {\n        slug = slug.substring(0, 91);\n        slug = slug.replace(/-+$/, ''); // X√≥a d·∫•u g·∫°ch th·ª´a ·ªü ƒëu√¥i\n    }\n    \n    return [{\n        json: {\n            ten_san_pham: title,\n            tu_khoa_seo: productInfo.tu_khoa_seo || \"pod product\",\n            slug: slug\n        }\n    }];\n\n} catch (error) {\n    // N·∫øu v·∫´n l·ªói, in ra nguy√™n nh√¢n ƒë·ªÉ s·ª≠a\n    return [{\n        json: {\n            error: \"L·ªói Parse JSON\",\n            message: error.message,\n            raw_input_received: rawText\n        }\n    }];\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3856,
        -1488
      ],
      "id": "afc23a96-623b-4615-9e81-b1067926961c",
      "name": "Code in JavaScript18"
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineByPosition",
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        -3680,
        -1568
      ],
      "id": "a6c4517f-82aa-44e6-b5cf-4996b97a9207",
      "name": "Merge7"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.limit",
      "typeVersion": 1,
      "position": [
        -4896,
        -1728
      ],
      "id": "8c5502aa-8d1b-4a6c-b762-dc16ed392799",
      "name": "Limit3"
    },
    {
      "parameters": {
        "jsCode": "// S·∫Øp x·∫øp c√°c item theo t√™n file gi·∫£m d·∫ßn (3 -> 2 -> 1)\nitems.sort((a, b) => {\n  // L·∫•y t√™n file t·ª´ bi·∫øn a v√† b.\n  // H√£y ki·ªÉm tra xem tr∆∞·ªùng t√™n file c·ªßa b·∫°n l√† 'name' hay 'File Name'\n  // Th√¥ng th∆∞·ªùng output t·ª´ Google Drive List l√† 'name'\n  const nameA = a.json.name || a.json['File Name'] || '';\n  const nameB = b.json.name || b.json['File Name'] || '';\n\n  // S·ª≠ d·ª•ng localeCompare v·ªõi t√πy ch·ªçn numeric: true ƒë·ªÉ so s√°nh s·ªë t·ª± nhi√™n\n  // (v√≠ d·ª•: ƒë·ªÉ m√°y hi·ªÉu s·ªë 10 l·ªõn h∆°n s·ªë 2, thay v√¨ so s√°nh chu·ªói thu·∫ßn t√∫y)\n  // b.localeCompare(a) s·∫Ω tr·∫£ v·ªÅ th·ª© t·ª± GI·∫¢M D·∫¶N (Descending)\n  return nameB.localeCompare(nameA, undefined, { numeric: true, sensitivity: 'base' });\n});\n\nreturn items;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -4672,
        -1552
      ],
      "id": "bfdc8036-4581-402e-a1e1-2ad259a4c18c",
      "name": "Code in JavaScript6"
    },
    {
      "parameters": {
        "resource": "image",
        "operation": "analyze",
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-pro",
          "mode": "list",
          "cachedResultName": "models/gemini-2.5-pro"
        },
        "text": "You are an expert in SEO and E-commerce (POD).\nAnalyze this product image and extract information in STRICT JSON format.\n\nRULES:\n1. All content must be in ENGLISH.\n2. First, identify the \"tu_khoa_seo\" (Main Keyword). It must be the core product name (3-6 words).\n3. \"ten_san_pham\" MUST follow this exact formula: \"{tu_khoa_seo} - {Descriptive Suffix}\".\n   - The Suffix describes features, material, or theme.\n4. \"slug\" MUST be the kebab-case version of the \"tu_khoa_seo\" (and optionally 1 short category word).\n5. \"slug\" MUST be LESS THAN 86 characters.\n6. Do NOT abbreviate sports team names. Always use the Full Official Name (City + Mascot). Example: Use \"Chicago Bulls\", never just \"Bulls\" or \"Chicago\".\n\nJSON Structure:\n{\n  \"ten_san_pham\": \"Main Keyword - Detailed Suffix\",\n  \"tu_khoa_seo\": \"Main Keyword\",\n  \"slug\": \"main-keyword-category\"\n}\n\nEXAMPLE INPUT (Logic to follow):\n- Image: A whiskey decanter shaped like a basketball player for Lakers fans.\n- OUTPUT JSON:\n{\n  \"ten_san_pham\": \"Los Angeles Lakers Whiskey Bottle - NBA 3D Dunking Player Tribute Decanter\",\n  \"tu_khoa_seo\": \"Los Angeles Lakers Whiskey Bottle\",\n  \"slug\": \"los-angeles-lakers-whiskey-bottle-nba\"\n}",
        "inputType": "binary",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        -4032,
        -1488
      ],
      "id": "20e782c8-07ef-4e00-bcb0-e10dbfd99902",
      "name": "Ph√¢n t√≠ch ·∫£nh1",
      "credentials": {
        "googlePalmApi": {
          "id": "ZbPcQI2SHz0NvP4Y",
          "name": "Gemini"
        }
      }
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "1DedkgcgjD0YZuy7zRKxFShRsUrsGhhUk7GlDccVjVck",
          "mode": "list",
          "cachedResultName": "Pod",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1DedkgcgjD0YZuy7zRKxFShRsUrsGhhUk7GlDccVjVck/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1108414039,
          "mode": "list",
          "cachedResultName": "League",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1DedkgcgjD0YZuy7zRKxFShRsUrsGhhUk7GlDccVjVck/edit#gid=1108414039"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "trang_thai": "Pending",
            "ten_san_pham": "={{ $json.ten_san_pham }}",
            "anh_1": "={{ $json.anh_1 }}",
            "anh_2": "={{ $json.anh_2 }}",
            "anh_3": "={{ $json.anh_3 }}",
            "tu_khoa_seo": "={{ $json.tu_khoa_seo }}",
            "slug": "={{ $json.slug }}"
          },
          "matchingColumns": [
            "slug"
          ],
          "schema": [
            {
              "id": "trang_thai",
              "displayName": "trang_thai",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "ten_san_pham",
              "displayName": "ten_san_pham",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "anh_1",
              "displayName": "anh_1",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "anh_2",
              "displayName": "anh_2",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "anh_3",
              "displayName": "anh_3",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "gia_goc",
              "displayName": "gia_goc",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "gia_sale",
              "displayName": "gia_sale",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "tu_khoa_seo",
              "displayName": "tu_khoa_seo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "slug",
              "displayName": "slug",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "tags",
              "displayName": "tags",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "categories",
              "displayName": "categories",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -3488,
        -1520
      ],
      "id": "25414581-743c-4a23-8767-b0bdf0d1231b",
      "name": "Sheet Raw League",
      "executeOnce": false,
      "alwaysOutputData": false,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "6yUNJbZX45z2GUMs",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// ================================================================\n// PH·∫¶N 1: T√çNH TO√ÅN CATEGORY ID (T√çCH H·ª¢P M·ªöI)\n// ================================================================\nconst item = items[0].json;\n\nconst categoryNode = $('Gom Categories');\nlet allCategories = [];\n\nif (categoryNode.first() && categoryNode.first().json.categories) {\n    allCategories = categoryNode.first().json.categories;\n} else {\n    allCategories = categoryNode.all().map(i => i.json);\n}\nlet calculatedId = 15; \n\nconst myCategoryName = item.categories;\n\nif (myCategoryName && Array.isArray(allCategories)) {\n    const foundCat = allCategories.find(cat => \n        cat.name && cat.name.toString().toLowerCase().trim() === myCategoryName.toString().toLowerCase().trim()\n    );\n    \n    if (foundCat) {\n        calculatedId = foundCat.id;\n    }\n}\n\nconst tagNode = $('Gom Tags'); \nlet allTags = [];\n\n// Truy c·∫≠p v√†o bi·∫øn 'tags' m√† node B∆∞·ªõc 2 ƒë√£ gom\nif (tagNode.first() && tagNode.first().json.tags) {\n    allTags = tagNode.first().json.tags;\n}\n\nlet tagIds = []; \n\n// 1. L·∫•y chu·ªói tag t·ª´ Sheet (V√≠ d·ª•: \"Lakers, NBA, Sport\")\n// Thay 'item.tags' b·∫±ng t√™n c·ªôt th·ª±c t·∫ø c·ªßa b·∫°n\nconst rawTagString = item.tags; \n\nif (rawTagString && allTags.length > 0) {\n    const tagNames = rawTagString.toString().split(',').map(t => t.trim());\n\n    // 3. L·∫∑p qua t·ª´ng t√™n tag ƒë·ªÉ t√¨m ID\n    tagNames.forEach(tagName => {\n        const foundTag = allTags.find(t => \n            t.name.toLowerCase() === tagName.toLowerCase()\n        );\n        \n        if (foundTag) {\n            tagIds.push(foundTag.id);\n        } else {\n            // (T√πy ch·ªçn) N·∫øu kh√¥ng t√¨m th·∫•y tag n√†o th√¨ log ra ƒë·ªÉ bi·∫øt\n            // console.log(`Kh√¥ng t√¨m th·∫•y tag: ${tagName}`);\n        }\n    });\n}\n\n// ================================================================\n// PH·∫¶N 2: X·ª¨ L√ù ·∫¢NH V√Ä N·ªòI DUNG (CODE C≈® C·ª¶A B·∫†N)\n// ================================================================\n\n// L·∫•y n·ªôi dung b√†i vi·∫øt t·ª´ AI\nlet content = item.main_description_html || \"\"; // Th√™m || \"\" ƒë·ªÉ tr√°nh l·ªói n·∫øu null\n\n// L·∫•y link ·∫£nh t·ª´ Sheet\nconst linkImg1 = item.anh_1; \nconst linkImg2 = item.anh_2;\nconst altText = item.ten_san_pham; \n\n// T·∫°o m√£ HTML cho ·∫£nh\nconst htmlImg1 = `<figure style=\"text-align:center; margin: 25px 0;\">\n                    <img src=\"${linkImg1}\" alt=\"${altText} - Front View\" style=\"max-width: 100%; height: auto; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);\">\n                    <figcaption style=\"font-style: italic; color: #555; margin-top: 5px;\">${altText}</figcaption>\n                 </figure>`;\n\nconst htmlImg2 = `<figure style=\"text-align:center; margin: 25px 0;\">\n                    <img src=\"${linkImg2}\" alt=\"${altText} - Detail View\" style=\"max-width: 100%; height: auto; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);\">\n                 </figure>`;\n\n// TH·ª∞C HI·ªÜN THAY TH·∫æ\n// 1. ·∫¢nh 1\nif (content.includes('[IMG_1]') && linkImg1) {\n    content = content.replace('[IMG_1]', htmlImg1);\n} else if (linkImg1) {\n    content = content.replace('</p>', '</p>' + htmlImg1);\n}\n\n// 2. ·∫¢nh 2\nif (content.includes('[IMG_2]') && linkImg2) {\n    content = content.replace('[IMG_2]', htmlImg2);\n} else if (linkImg2) {\n    content += htmlImg2;\n}\n\n// C·∫≠p nh·∫≠t l·∫°i n·ªôi dung\nitem.main_description_html = content;\n\n// T·∫†O GALLERY CHO WOOCOMMERCE\nconst images = [];\nfunction addImage(url) {\n  if (url && url.toString().startsWith('http')) {\n    images.push({ src: url.toString().trim(), alt: altText });\n  }\n}\naddImage(item.anh_1);\naddImage(item.anh_2);\naddImage(item.anh_3);\naddImage(item.anh_4);\n\n// ================================================================\n// PH·∫¶N 3: TR·∫¢ V·ªÄ K·∫æT QU·∫¢ T·ªîNG H·ª¢P\n// ================================================================\n\nreturn [{\n  json: {\n    ...item,\n    woo_images: images,\n    calculated_category_id: calculatedId,\n    calculated_tag_ids: tagIds\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2880,
        -2224
      ],
      "id": "7ced225d-43b1-425e-bc82-f9e94f1feb0b",
      "name": "Code C√≥ bi·∫øn tag"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -4480,
        -1952
      ],
      "id": "ae2a9e59-d490-4a05-8d6e-faae19682692",
      "name": "Loop Over Items6"
    },
    {
      "parameters": {
        "jsCode": "// L·∫•y n·ªôi dung text g·ªëc t·ª´ Gemini\nconst rawText = items[0].json.content.parts[0].text;\n\ntry {\n  // 1. T√¨m v·ªã tr√≠ d·∫•u ngo·∫∑c nh·ªçn m·ªü '{' ƒë·∫ßu ti√™n v√† ƒë√≥ng '}' cu·ªëi c√πng\n  const firstOpen = rawText.indexOf('{');\n  const lastClose = rawText.lastIndexOf('}');\n\n  if (firstOpen === -1 || lastClose === -1) {\n    throw new Error(\"Kh√¥ng t√¨m th·∫•y d·∫•u ngo·∫∑c JSON {} trong ph·∫£n h·ªìi c·ªßa AI\");\n  }\n\n  // 2. C·∫Øt l·∫•y ƒë√∫ng ƒëo·∫°n JSON, b·ªè qua l·ªùi d·∫´n chuy·ªán th·ª´a th√£i\n  let cleanJson = rawText.substring(firstOpen, lastClose + 1);\n\n  // 3. (M·∫πo n√¢ng cao) S·ª≠a l·ªói d√≤ng m·ªõi n·∫øu AI l·ª° xu·ªëng d√≤ng trong chu·ªói\n  // cleanJson = cleanJson.replace(/\\n/g, \"\\\\n\"); // Ch·ªâ b·∫≠t d√≤ng n√†y n·∫øu v·∫´n l·ªói\n\n  // 4. Parse JSON\n  const data = JSON.parse(cleanJson);\n\n  return [ { json: data } ];\n\n} catch (error) {\n  // N·∫øu l·ªói, tr·∫£ v·ªÅ nguy√™n vƒÉn text ƒë·ªÉ Debug xem sai ·ªü ƒë√¢u\n  return [\n    {\n      json: {\n        error: error.message,\n        raw_content_to_debug: rawText // Xem c√°i n√†y ·ªü c·ªôt Output ƒë·ªÉ bi·∫øt AI vi·∫øt sai ch·ªó n√†o\n      }\n    }\n  ];\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -4000,
        -1888
      ],
      "id": "ff31f169-4240-4bbd-8522-13db643a7348",
      "name": "Code in JavaScript14"
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineByPosition",
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        -3840,
        -1952
      ],
      "id": "669279c3-333e-4f1b-81f2-61b3d4ed257c",
      "name": "Merge6"
    },
    {
      "parameters": {
        "jsCode": "\nconst item = items[0].json;\n\n// L·∫•y n·ªôi dung b√†i vi·∫øt t·ª´ AI\nlet content = item.main_description_html || \"\"; // Th√™m || \"\" ƒë·ªÉ tr√°nh l·ªói n·∫øu null\n\n// L·∫•y link ·∫£nh t·ª´ Sheet\nconst linkImg1 = item.anh_1; \nconst linkImg2 = item.anh_2;\nconst altText = item.ten_san_pham; \n\n// T·∫°o m√£ HTML cho ·∫£nh\nconst htmlImg1 = `<figure style=\"text-align:center; margin: 25px 0;\">\n                    <img src=\"${linkImg1}\" alt=\"${altText} - Front View\" style=\"max-width: 100%; height: auto; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);\">\n                    <figcaption style=\"font-style: italic; color: #555; margin-top: 5px;\">${altText}</figcaption>\n                 </figure>`;\n\nconst htmlImg2 = `<figure style=\"text-align:center; margin: 25px 0;\">\n                    <img src=\"${linkImg2}\" alt=\"${altText} - Detail View\" style=\"max-width: 100%; height: auto; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);\">\n                 </figure>`;\n\n// TH·ª∞C HI·ªÜN THAY TH·∫æ\n// 1. ·∫¢nh 1\nif (content.includes('[IMG_1]') && linkImg1) {\n    content = content.replace('[IMG_1]', htmlImg1);\n} else if (linkImg1) {\n    content = content.replace('</p>', '</p>' + htmlImg1);\n}\n\n// 2. ·∫¢nh 2\nif (content.includes('[IMG_2]') && linkImg2) {\n    content = content.replace('[IMG_2]', htmlImg2);\n} else if (linkImg2) {\n    content += htmlImg2;\n}\n\n// C·∫≠p nh·∫≠t l·∫°i n·ªôi dung\nitem.main_description_html = content;\n\n// T·∫†O GALLERY CHO WOOCOMMERCE\nconst images = [];\nfunction addImage(url) {\n  if (url && url.toString().startsWith('http')) {\n    images.push({ src: url.toString().trim(), alt: altText });\n  }\n}\naddImage(item.anh_1);\naddImage(item.anh_2);\naddImage(item.anh_3);\naddImage(item.anh_4);\n\n// ================================================================\n// PH·∫¶N 3: TR·∫¢ V·ªÄ K·∫æT QU·∫¢ T·ªîNG H·ª¢P\n// ================================================================\n\nreturn [{\n  json: {\n    ...item,\n    woo_images: images\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3680,
        -1952
      ],
      "id": "a87e7686-81e1-48b7-ba7f-8d8d79195721",
      "name": "Code in JavaScript15"
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-flash",
          "mode": "list",
          "cachedResultName": "models/gemini-2.5-flash"
        },
        "messages": {
          "values": [
            {
              "content": "=B·∫°n l√† m·ªôt chuy√™n gia SEO Copywriter E-commerce (Native English Speaker).\nNhi·ªám v·ª• c·ªßa b·∫°n l√† vi·∫øt n·ªôi dung s·∫£n ph·∫©m chuy√™n s√¢u d·ª±a tr√™n th√¥ng tin sau:\n\nINPUT DATA:\n- Product Name: {{ $json.ten_san_pham }}\n- Focus Keyword: {{ $json.tu_khoa_seo }}\n\nY√äU C·∫¶U NGHI√äM NG·∫∂T V·ªÄ N·ªòI DUNG (STRICT GUIDELINES):\n1. Ng√¥n ng·ªØ: Ti·∫øng Anh chu·∫©n (US English), vƒÉn phong b√°n h√†ng chuy√™n nghi·ªáp, thuy·∫øt ph·ª•c.\n2. ƒê·ªô d√†i: B·∫ÆT BU·ªòC tr√™n 500 t·ª´ (Kh√¥ng t√≠nh ph·∫ßn HTML tags).\n3. ƒê·ªãnh d·∫°ng: HTML chu·∫©n (s·ª≠ d·ª•ng <h2>, <h3>, <p>, <ul>, <li>). Kh√¥ng d√πng th·∫ª <h1>. Kh√¥ng d√πng Markdown (```).\n4. M·∫≠t ƒë·ªô t·ª´ kh√≥a: Duy tr√¨ \"Focus Keyword\" ·ªü m·ª©c 1.2% - 1.5%. Ph·∫£i xu·∫•t hi·ªán t·ª± nhi√™n ·ªü ƒëo·∫°n m·ªü ƒë·∫ßu, √≠t nh·∫•t 1 th·∫ª H2, v√† r·∫£i r√°c trong b√†i.\n5. NO ICONS/EMOJIS: Tuy·ªát ƒë·ªëi kh√¥ng s·ª≠ d·ª•ng icon (üöÄ, üåü,...) trong b√†i vi·∫øt.\n6. N·ªôi dung duy nh·∫•t: T·∫≠p trung s√¢u v√†o m√¥ t·∫£ s·∫£n ph·∫©m (ch·∫•t li·ªáu, c·∫£m gi√°c m·∫∑c, d·ªãp s·ª≠ d·ª•ng, h∆∞·ªõng d·∫´n b·∫£o qu·∫£n). Kh√¥ng vi·∫øt chung chung.\n\nY√äU C·∫¶U V·ªÄ B·ªê C·ª§C H√åNH ·∫¢NH:\nTrong ph·∫ßn n·ªôi dung chi ti·∫øt (main_description_html), b·∫°n h√£y ch√®n 2 k√Ω hi·ªáu gi·ªØ ch·ªó (placeholder) sau:\n1. \"[IMG_1]\" : ƒê·∫∑t ngay sau ƒëo·∫°n m·ªü ƒë·∫ßu (Introduction) ho·∫∑c sau th·∫ª H2 ƒë·∫ßu ti√™n.\n2. \"[IMG_2]\" : ƒê·∫∑t ·ªü g·∫ßn cu·ªëi b√†i vi·∫øt, tr∆∞·ªõc ph·∫ßn k·∫øt lu·∫≠n ho·∫∑c FAQs.\n\nL∆∞u √Ω: Ch·ªâ vi·∫øt ƒë√∫ng k√Ω t·ª± \"[IMG_1]\" v√† \"[IMG_2]\", kh√¥ng t·ª± b·ªãa ra th·∫ª h√¨nh ·∫£nh html.\n\nY√äU C·∫¶U V·ªÄ TR√åNH B√ÄY & KH·∫¢ NƒÇNG ƒê·ªåC (READABILITY):\n1. QUY T·∫ÆC \"3 D√íNG\": Tuy·ªát ƒë·ªëi KH√îNG vi·∫øt ƒëo·∫°n vƒÉn d√†i l√™ th√™ (Wall of text). M·ªói ƒëo·∫°n vƒÉn (paragraph) ch·ªâ ƒë∆∞·ª£c ch·ª©a t·ªëi ƒëa 3 c√¢u ng·∫Øn. Sau 2-3 c√¢u b·∫Øt bu·ªôc ph·∫£i ƒë√≥ng th·∫ª </p> v√† m·ªü th·∫ª <p> m·ªõi.\n2. FORMATTING:\n   - S·ª≠ d·ª•ng danh s√°ch li·ªát k√™ (<ul><li>) b·∫•t c·ª© khi n√†o c√≥ th·ªÉ (thay v√¨ vi·∫øt c√¢u li·ªát k√™ d√†i d√≤ng).\n   - In ƒë·∫≠m (<strong>) c√°c t·ª´ kh√≥a quan tr·ªçng ho·∫∑c l·ª£i √≠ch ch√≠nh ƒë·ªÉ l√†m ƒëi·ªÉm nh·∫•n.\n3. TONE GI·ªåNG: Vi·∫øt g√£y g·ªçn, s√∫c t√≠ch, ng·∫Øt ngh·ªâ r√µ r√†ng ƒë·ªÉ kh√°ch h√†ng l∆∞·ªõt nhanh tr√™n ƒëi·ªán tho·∫°i v·∫´n n·∫Øm ƒë∆∞·ª£c √Ω.\n\nC·∫§U TR√öC B√ÄI VI·∫æT (HTML Output):\n- Ph·∫ßn 1: Introduction (G√¢y ·∫•n t∆∞·ª£ng m·∫°nh, ch·ª©a t·ª´ kh√≥a).\n- Ph·∫ßn 2: Key Features (D√πng <ul>, m√¥ t·∫£ chi ti·∫øt l·ª£i √≠ch).\n- Ph·∫ßn 3: Why You Need This (ƒê√°nh v√†o c·∫£m x√∫c, nhu c·∫ßu qu√† t·∫∑ng/l·ªÖ h·ªôi).\n- Ph·∫ßn 4: Material & Care Instructions (Chi ti·∫øt k·ªπ thu·∫≠t).\n- Ph·∫ßn 5: FAQs (Ph·∫ßn n√†y r·∫•t quan tr·ªçng - xem y√™u c·∫ßu b√™n d∆∞·ªõi).\n\nY√äU C·∫¶U V·ªÄ FAQs (5 C√¢u h·ªèi):\n- Vi·∫øt ƒë√∫ng 5 c√¢u h·ªèi v√† c√¢u tr·∫£ l·ªùi.\n- CH·ª¶ ƒê·ªÄ AN TO√ÄN: Ch·ªâ h·ªèi v·ªÅ size (sizing), v·∫≠n chuy·ªÉn (shipping time), ch·∫•t li·ªáu (material comfort), h∆∞·ªõng d·∫´n gi·∫∑t (washing), qu√† t·∫∑ng (gift wrapping).\n- C·∫§M K·ª¥ (NEGATIVE CONSTRAINT): TUY·ªÜT ƒê·ªêI KH√îNG h·ªèi/tr·∫£ l·ªùi c√°c c√¢u li√™n quan ƒë·∫øn \"Authentic\", \"Official Licensed\", \"Original Brand\". Tr√°nh nh·∫Øc ƒë·∫øn b·∫£n quy·ªÅn th∆∞∆°ng hi·ªáu g·ªëc ƒë·ªÉ ƒë·∫£m b·∫£o an to√†n t√†i kho·∫£n.\n\nOUTPUT FORMAT (JSON RAW ONLY):\nTr·∫£ v·ªÅ duy nh·∫•t 1 object JSON, kh√¥ng k√®m l·ªùi d·∫´n:\n{\n  \"short_description\": \"Vi·∫øt ƒëo·∫°n m√¥ t·∫£ ng·∫Øn (Product Short Description) kho·∫£ng 64 t·ª´. T·∫≠p trung v√†o 'Hook' ƒë·ªÉ kh√°ch h√†ng mu·ªën mua ngay. Kh√¥ng d√πng HTML ·ªü ƒë√¢y, ch·ªâ text th∆∞·ªùng.\",\n  \"main_description_html\": \"To√†n b·ªô n·ªôi dung b√†i vi·∫øt chi ti·∫øt (tr√™n 600 t·ª´) + FAQs theo ƒë·ªãnh d·∫°ng HTML ·ªü tr√™n.\"\n}"
            }
          ]
        },
        "jsonOutput": true,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        -4288,
        -1888
      ],
      "id": "401f90c9-6159-4dcd-9574-8e2cc00c44f7",
      "name": "T·∫°o n·ªôi dung1",
      "credentials": {
        "googlePalmApi": {
          "id": "ZbPcQI2SHz0NvP4Y",
          "name": "Gemini"
        }
      }
    },
    {
      "parameters": {
        "resource": "product",
        "operation": "create",
        "name": "={{ $json.ten_san_pham }}",
        "additionalFields": {
          "description": "={{ $json.main_description_html }}\n\n<br><hr><br>\n<div style=\"text-align: center;\">\n  <p><strong>Official Authentic Product</strong></p>\n  <a href=\"https://leaguelockergear.com/\" target=\"_blank\" rel=\"nofollow\">\n     <img src=\"https://leaguelockergear.com/wp-content/uploads/2025/10/cropped-logo-remove-small.png\" width=\"200\" alt=\"LeagueLockerGear\">\n  </a>\n</div>",
          "regularPrice": "={{ $json.gia_goc }}",
          "salePrice": "={{ $json.gia_sale }}",
          "shortDescription": "={{ $json.short_description }}",
          "slug": "={{ $json.slug }}"
        },
        "dimensionsUi": {},
        "imagesUi": {
          "imagesValues": [
            {
              "alt": "={{ $json.woo_images[0].alt }}",
              "src": "={{ $json.woo_images[0].src }}",
              "name": ""
            },
            {
              "alt": "={{ $json.woo_images[1].alt }}",
              "src": "={{ $json.woo_images[1].src }}",
              "name": ""
            },
            {
              "alt": "={{ $json.woo_images[2].alt }}",
              "src": "={{ $json.woo_images[2].src }}",
              "name": ""
            }
          ]
        },
        "metadataUi": {
          "metadataValues": [
            {
              "key": "rank_math_focus_keyword",
              "value": "={{ $json.tu_khoa_seo }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.wooCommerce",
      "typeVersion": 1,
      "position": [
        -3504,
        -1952
      ],
      "id": "de8b539e-1f1f-4649-b5c9-92b440b12ed4",
      "name": "League",
      "credentials": {
        "wooCommerceApi": {
          "id": "Gfs8SSLfTHpMr9bP",
          "name": "League Credential"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1DedkgcgjD0YZuy7zRKxFShRsUrsGhhUk7GlDccVjVck",
          "mode": "list",
          "cachedResultName": "Pod",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1DedkgcgjD0YZuy7zRKxFShRsUrsGhhUk7GlDccVjVck/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1108414039,
          "mode": "list",
          "cachedResultName": "League",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1DedkgcgjD0YZuy7zRKxFShRsUrsGhhUk7GlDccVjVck/edit#gid=1108414039"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "trang_thai",
              "lookupValue": "Pending"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -4688,
        -1952
      ],
      "id": "92744901-b7ce-4eec-b68a-f445b15aac96",
      "name": "Sheet League(Input)",
      "executeOnce": false,
      "alwaysOutputData": false,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "6yUNJbZX45z2GUMs",
          "name": "Google Sheets account"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "When clicking ‚ÄòExecute workflow‚Äô": {
      "main": [
        [
          {
            "node": "Sheet League(Input)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Hoop": {
      "main": [
        [
          {
            "node": "Loop Over Items4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "L·ªçc Categories cho Hoop": {
      "main": [
        [
          {
            "node": "Gom Categories",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Gom Categories": {
      "main": [
        [
          {
            "node": "L·ªçc Tags cho Hoop",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "L·ªçc Tags cho Hoop": {
      "main": [
        [
          {
            "node": "Gom Tags",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Gom Tags": {
      "main": [
        []
      ]
    },
    "HTTP Request": {
      "main": [
        [
          {
            "node": "Code in JavaScript8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript8": {
      "main": [
        [
          {
            "node": "Merge7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Search (LEAGUE)": {
      "main": [
        [
          {
            "node": "Loop Over Items7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Search (HOOP)": {
      "main": [
        [
          {
            "node": "Loop Over Items5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP POST HOOP": {
      "main": [
        [
          {
            "node": "Code in JavaScript9",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript9": {
      "main": [
        [
          {
            "node": "Merge5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items4": {
      "main": [
        [],
        [
          {
            "node": "Merge4",
            "type": "main",
            "index": 1
          },
          {
            "node": "T·∫°o n·ªôi dung",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript10": {
      "main": [
        [
          {
            "node": "Merge4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge4": {
      "main": [
        [
          {
            "node": "Code in JavaScript11",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript11": {
      "main": [
        [
          {
            "node": "Hoop",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items5": {
      "main": [
        [],
        [
          {
            "node": "Search files and folders",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Search files and folders": {
      "main": [
        [
          {
            "node": "Code in JavaScript3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Download file1": {
      "main": [
        [
          {
            "node": "Limit1",
            "type": "main",
            "index": 0
          },
          {
            "node": "Code in JavaScript12",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript12": {
      "main": [
        [
          {
            "node": "HTTP POST HOOP",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Limit1": {
      "main": [
        [
          {
            "node": "Ph√¢n t√≠ch ·∫£nh",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript13": {
      "main": [
        [
          {
            "node": "Merge5",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Merge5": {
      "main": [
        [
          {
            "node": "Sheet Hoop(Raw output, need improve)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create product (HOOP)": {
      "main": [
        []
      ]
    },
    "Sheet Hoop(Input)": {
      "main": [
        [
          {
            "node": "Loop Over Items4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Sheet Hoop(Raw output, need improve)": {
      "main": [
        [
          {
            "node": "Loop Over Items5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Limit2": {
      "main": [
        []
      ]
    },
    "Code in JavaScript3": {
      "main": [
        [
          {
            "node": "Download file1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Ph√¢n t√≠ch ·∫£nh": {
      "main": [
        [
          {
            "node": "Code in JavaScript13",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "T·∫°o n·ªôi dung": {
      "main": [
        [
          {
            "node": "Code in JavaScript10",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ƒê·∫∑t t√™n cho ·∫£nh": {
      "main": [
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Ph√¢n t√≠ch h√¨nh ·∫£nh1": {
      "main": [
        [
          {
            "node": "T·∫°o 2 ·∫£nh li√™n quan t·ªõi s·∫£n ph·∫©m",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items7": {
      "main": [
        [],
        [
          {
            "node": "Search files and folders1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Search files and folders1": {
      "main": [
        [
          {
            "node": "Code in JavaScript6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Download file2": {
      "main": [
        [
          {
            "node": "Limit",
            "type": "main",
            "index": 0
          },
          {
            "node": "ƒê·∫∑t t√™n cho ·∫£nh",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Limit": {
      "main": [
        [
          {
            "node": "Ph√¢n t√≠ch ·∫£nh1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript18": {
      "main": [
        [
          {
            "node": "Merge7",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Merge7": {
      "main": [
        [
          {
            "node": "Sheet Raw League",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Limit3": {
      "main": [
        []
      ]
    },
    "Code in JavaScript6": {
      "main": [
        [
          {
            "node": "Download file2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Ph√¢n t√≠ch ·∫£nh1": {
      "main": [
        [
          {
            "node": "Code in JavaScript18",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Sheet Raw League": {
      "main": [
        [
          {
            "node": "Loop Over Items7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code C√≥ bi·∫øn tag": {
      "main": [
        []
      ]
    },
    "Loop Over Items6": {
      "main": [
        [],
        [
          {
            "node": "Merge6",
            "type": "main",
            "index": 1
          },
          {
            "node": "T·∫°o n·ªôi dung1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript14": {
      "main": [
        [
          {
            "node": "Merge6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge6": {
      "main": [
        [
          {
            "node": "Code in JavaScript15",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript15": {
      "main": [
        [
          {
            "node": "League",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "T·∫°o n·ªôi dung1": {
      "main": [
        [
          {
            "node": "Code in JavaScript14",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "League": {
      "main": [
        [
          {
            "node": "Loop Over Items6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Sheet League(Input)": {
      "main": [
        [
          {
            "node": "Loop Over Items6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "a33f14be-778e-4e48-8b6c-98c59e5ac95a",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "d800b4ad3f2d1d422d71b70ea8819130b67c715e52d01c3bf3036f858c4ff588"
  },
  "id": "sair1Tv4luQ4V4a5",
  "tags": []
}